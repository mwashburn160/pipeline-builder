# ============================================================================
# Pipeline Manager - Environment Configuration
# ============================================================================
# Copy this file to .env and update with your actual values
# IMPORTANT: Never commit .env file to version control!
# Add .env to .gitignore
# ============================================================================

# ============================================================================
# Platform Configuration
# ============================================================================

# Platform URL - Used by services to reference the API gateway
# Used by CLI when PLATFORM_BASE_URL environment variable is not set
PLATFORM_BASE_URL=https://localhost:8443

# Frontend URL - Used for email links, OAuth redirects, etc.
PLATFORM_FRONTEND_URL=https://localhost:8443

# Trust proxy headers (for production behind load balancer)
# Set to 1 if behind nginx, ALB, etc.
TRUST_PROXY=1

# ============================================================================
# JWT Configuration (REQUIRED)
# ============================================================================

# JWT Secret - Used to sign and verify PLATFORM_TOKEN
# SECURITY: Generate a strong random secret (32+ characters)
# Example: openssl rand -base64 32
JWT_SECRET=no-secret

# JWT Token expiration (in seconds)
# 900 = 15 minutes, 3600 = 1 hour, 86400 = 24 hours
JWT_EXPIRES_IN=86400

# JWT Salt rounds for bcrypt
# Higher = more secure but slower (10-12 recommended)
JWT_SALT_ROUNDS=12

# Refresh Token Secret - Separate secret for refresh tokens
# SECURITY: Generate a different secret from JWT_SECRET
REFRESH_TOKEN_SECRET=no-secret

# Refresh Token expiration (in seconds)
# 2592000 = 30 days
REFRESH_TOKEN_EXPIRES_IN=2592000

# ============================================================================
# Google OAuth Configuration (Optional)
# ============================================================================
# Enables "Continue with Google" on login/register pages.
# Create credentials at: https://console.cloud.google.com/apis/credentials
# Authorized redirect URI: ${PLATFORM_FRONTEND_URL}/auth/callback/google

# Google OAuth Client ID (leave empty to disable)
OAUTH_GOOGLE_CLIENT_ID=
OAUTH_GOOGLE_CLIENT_SECRET=

# OAuth callback base URL (defaults to PLATFORM_FRONTEND_URL if not set)
# Only override if your frontend URL differs from the OAuth redirect origin
OAUTH_CALLBACK_BASE_URL=${PLATFORM_FRONTEND_URL}

# ============================================================================
# Organization Quota Defaults
# ============================================================================
# Default limits applied to new organizations
# Used by: quota service
# System admins can override these per-organization

# Maximum plugins per organization
QUOTA_DEFAULT_PLUGINS=100

# Maximum pipelines per organization
QUOTA_DEFAULT_PIPELINES=50

# Maximum API calls per organization (per reset period)
QUOTA_DEFAULT_API_CALLS=10000

# Quota reset period in days
# Usage counters reset after this many days
QUOTA_RESET_DAYS=3

# ============================================================================
# Quota Service Configuration
# ============================================================================
# Internal service discovery for quota enforcement
# Used by: plugin, pipeline services

# Quota service hostname (Docker service name)
QUOTA_SERVICE_HOST=quota

# Quota service port
QUOTA_SERVICE_PORT=3000

# ============================================================================
# Rate Limiting Configuration
# ============================================================================
# Per-organization rate limits for API operations
# Set to 'unlimited' to disable rate limiting for an operation

# Organization ID that bypasses all quotas (typically 'system')
QUOTA_BYPASS_ORG_ID=system

# Default rate limit window in milliseconds (60000 = 60 seconds)
QUOTA_DEFAULT_WINDOW_MS=60000

# Plugin rate limits
# Create plugin: requests per window (set to 'unlimited' for no limit)
QUOTA_CREATE_PLUGIN_LIMIT=unlimited
QUOTA_CREATE_PLUGIN_WINDOW_MS=60000

# Get plugin by ID: requests per window
QUOTA_GET_PLUGIN_LIMIT=10
QUOTA_GET_PLUGIN_WINDOW_MS=60000

# Pipeline rate limits
# Create pipeline: requests per window (set to 'unlimited' for no limit)
QUOTA_CREATE_PIPELINE_LIMIT=unlimited
QUOTA_CREATE_PIPELINE_WINDOW_MS=60000

# Get pipeline by ID: requests per window
QUOTA_GET_PIPELINE_LIMIT=10
QUOTA_GET_PIPELINE_WINDOW_MS=60000

# ============================================================================
# Global Rate Limiting
# ============================================================================
# Applied to all API requests (independent of quota middleware)

# Maximum requests per window
LIMITER_MAX=100

# Rate limit window in milliseconds (900000 = 15 minutes)
LIMITER_WINDOWMS=900000

# ============================================================================
# Email Configuration (SMTP)
# ============================================================================

# Enable/disable email sending
EMAIL_ENABLED=false

# Sender information
EMAIL_FROM=noreply@example.com
EMAIL_FROM_NAME=Platform

# SMTP Configuration
SMTP_HOST=localhost
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=
SMTP_PASS=

# ============================================================================
# Invitation Configuration
# ============================================================================

# Invitation expiration (in days)
INVITATION_EXPIRATION_DAYS=7

# Maximum pending invitations per organization
INVITATION_MAX_PENDING_PER_ORG=50

# ============================================================================
# PostgreSQL Database Configuration
# ============================================================================

# PostgreSQL connection details
# Used by: postgres container, pipeline, plugin services
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_DB=pipeline_builder

# Database connection for services (should match POSTGRES_* values)
DB_HOST=postgres
DB_PORT=5432
DATABASE=pipeline_builder
DB_USER=postgres
DB_PASSWORD=password

# Drizzle ORM Configuration
DRIZZLE_MAX_POOL_SIZE=20
DRIZZLE_IDLE_TIMEOUT_MILLIS=30000
DRIZZLE_CONNECTION_TIMEOUT_MILLIS=10000

# ============================================================================
# MongoDB Configuration
# ============================================================================

# MongoDB Admin Credentials
# Used by: platform, quota services
MONGO_INITDB_ROOT_USERNAME=mongo
MONGO_INITDB_ROOT_PASSWORD=password
MONGO_INITDB_DATABASE=platform

# MongoDB Connection URI (Replica Set)
# Format: mongodb://username:password@host:port/database?options
# Used by: platform, quota services
MONGODB_URI=mongodb://mongo:password@mongodb:27017/platform?replicaSet=rs0&authSource=admin

# ============================================================================
# Mongo Express (MongoDB Admin UI)
# ============================================================================

# Mongo Express Configuration
# Access at: http://localhost:27081 or https://localhost:8443/mongo-express/
ME_CONFIG_SITE_BASEURL=/mongo-express/
ME_CONFIG_MONGODB_URL=mongodb://mongo:password@mongodb:27017/platform?replicaSet=rs0&authSource=admin
ME_CONFIG_MONGODB_ENABLE_ADMIN=true
ME_CONFIG_MONGODB_ADMINUSERNAME=mongo
ME_CONFIG_MONGODB_ADMINPASSWORD=password

# Mongo Express Web Authentication
ME_CONFIG_BASICAUTH_USERNAME=admin
ME_CONFIG_BASICAUTH_PASSWORD=password

# ============================================================================
# PgAdmin (PostgreSQL Admin UI)
# ============================================================================

# PgAdmin Configuration
# Access at: http://localhost:5480 or https://localhost:8443/pgadmin/
PGADMIN_DEFAULT_EMAIL=mwashburn160@gmail.com
PGADMIN_DEFAULT_PASSWORD=password

# ============================================================================
# Docker Registry Configuration
# ============================================================================

# Docker Registry for Plugin Images
# Used by: plugin service
IMAGE_REGISTRY_HOST=registry
IMAGE_REGISTRY_PORT=5000
IMAGE_REGISTRY_USER=admin
IMAGE_REGISTRY_TOKEN=password

# Docker socket GID — the plugin service mounts /var/run/docker.sock
# to build plugin images. Set this to the GID of the docker group on
# your host: run `stat -f '%g' /var/run/docker.sock` (macOS)
# or `stat -c '%g' /var/run/docker.sock` (Linux)
DOCKER_GID=0

# Docker network for plugin builds — the compose network where the
# registry service is reachable. Typically <project>_backend-network.
# Run `docker network ls` to find the correct name.
DOCKER_NETWORK=backend-network

# ============================================================================
# Registry UI (Docker Registry Web Interface)
# ============================================================================

# Joxit Docker Registry UI Configuration
# Access at: http://localhost:5080 or https://localhost:8443/registry-express/
JOXIT_REGISTRY_TITLE=Pipeline Builder Registry
JOXIT_NGINX_PROXY_PASS_URL=https://registry:5000
JOXIT_SINGLE_REGISTRY=true
JOXIT_ENABLE_DELETE_IMAGES=true
JOXIT_SHOW_CONTENT_DIGEST=true
